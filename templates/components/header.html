{# templates/components/header.html #}
{% set nav_items = [
  {'name':'Home',         'endpoint':'views.home',             'blueprint':None},
  {'name':'Bug Vault',    'endpoint':'bug_vault.index',        'blueprint':'bug_vault'},
  {'name':'Playground',   'endpoint':'pentest_playground.index','blueprint':'pentest_playground'},
  {'name':'Ghost Academy','endpoint':'academy.academy_home',   'blueprint':'academy'},
  {'name':'Dashboard',    'endpoint':'vault_dashboard.index',  'blueprint':'vault_dashboard'},
] %}

{% set actions = [
  {'id':'liveStatus',  'html':'<div class="h-3 w-3 rounded-full bg-emerald-500 animate-pulse" role="status" aria-label="Online"></div>'},
  {'id':'notifToggle','html':'<i class="fas fa-bell"></i><span class="notif-count">3</span>'},
  {'id':'cmdPalette','html':'<i class="fas fa-terminal"></i>'},
  {'id':'themeToggle','html':'<i class="fas fa-moon"></i>'},
] %}

<header id="siteHeader"
        class="fixed inset-x-0 top-0 z-50 bg-zinc-900/80 backdrop-blur-md transition-all duration-300 ease-in-out shrinkable-header"
        role="banner">
  <div class="container mx-auto flex items-center justify-between px-6 py-3">

    <!-- Logo -->
    <a href="{{ url_for('views.home') }}"
       class="flex items-center space-x-2 text-2xl font-black text-orangeLuxe hover:scale-105 focus:outline-none focus:ring-2 focus:ring-orangeLuxe transition-transform">
      <svg class="h-8 w-8 animate-spin-slow text-orangeLuxe" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7v7c0 5 4 9 10 9s10-4 10-9V7l-10-5z"/></svg>
      <span class="hidden sm:inline">CYBERKIDZSEC VAULT</span>
    </a>

    <!-- Nav & Search Wrapper -->
    <div class="flex-1 flex items-center justify-center lg:justify-start gap-6">

      <!-- Global Search (desktop only) -->
      <div class="relative hidden lg:block w-full max-w-md">
        <input id="globalSearch" type="search" placeholder="Search the Vault…" aria-label="Search reports"
               class="w-full pl-10 pr-4 bg-zinc-800 border border-zinc-700 rounded focus:border-orangeLuxe focus:ring-orangeLuxe placeholder-zinc-500 transition"/>
        <span class="absolute inset-y-0 left-3 flex items-center text-zinc-500"><i class="fas fa-search"></i></span>
        <kbd class="absolute right-3 top-1/2 -translate-y-1/2 bg-zinc-800 text-xs font-mono px-1 rounded text-zinc-400">⌘ K</kbd>
      </div>

      <!-- Main Nav -->
      <nav class="hidden lg:flex space-x-6" aria-label="Primary">
        {% for item in nav_items %}
        {% set is_active = (request.endpoint == item.endpoint) or (item.blueprint and request.blueprint == item.blueprint) %}
        <a href="{{ url_for(item.endpoint) }}"
           class="relative text-sm uppercase font-mono tracking-wide py-1 transition focus:outline-none focus:ring-2 focus:ring-orangeLuxe
                  {{ 'text-orangeLuxe' if is_active else 'text-zinc-300 hover:text-orangeLuxe-light' }}">
          {{ item.name }}
          {% if is_active %}
          <span class="absolute inset-x-0 -bottom-1 h-0.5 bg-orangeLuxe rounded-full"></span>
          {% endif %}
        </a>
        {% endfor %}
      </nav>
    </div>

    <!-- Action Cluster -->
    <div class="flex items-center space-x-3">
      {% for act in actions %}
      <div id="{{ act.id }}" class="p-2 rounded-full bg-zinc-800 hover:bg-zinc-700 focus:outline-none focus:ring-2 focus:ring-orangeLuxe transition">
        {{ act.html|safe }}
      </div>
      {% endfor %}

      <!-- Mobile Menu Toggle -->
      <button id="menuToggle" class="lg:hidden p-2 text-2xl text-zinc-300 hover:text-orangeLuxe focus:outline-none focus:ring-2 focus:ring-orangeLuxe transition" aria-controls="mobileNav" aria-expanded="false">
        ☰
      </button>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <nav id="mobileNav"
       class="fixed inset-x-0 top-full transform -translate-y-full bg-zinc-900/95 backdrop-blur-lg p-6 space-y-4 text-lg font-semibold transition-transform duration-300 ease-out lg:hidden"
       aria-label="Mobile">
    <ul class="flex flex-col gap-4">
      {% for item in nav_items %}
      <li>
        <a href="{{ url_for(item.endpoint) }}"
           class="block text-zinc-300 hover:text-orangeLuxe focus:outline-none focus:ring-2 focus:ring-orangeLuxe transition">
          {{ item.name }}
        </a>
      </li>
      {% endfor %}
    </ul>
  </nav>
</header>

<script>
(() => {
  const header = document.querySelector('.shrinkable-header');
  window.addEventListener('scroll', () => {
    header.style.padding = window.scrollY > 50 ? '0.25rem 1.5rem' : '0.75rem 1.5rem';
  });
})();
</script>

