<!-- components/quick_view_modal.html -->
<template id="quickViewTpl">
  <div class="fixed inset-0 z-[9999] flex items-center justify-center p-8 bg-black/70 backdrop-blur-md overflow-y-auto" role="dialog" aria-modal="true">
    <div class="relative w-full max-w-2xl bg-gradient-to-br from-cyberNight via-cyberNight-glow to-cyberNight-phantom border border-orangeLuxe/30 rounded-2xl shadow-[0_0_40px_rgba(249,115,22,0.25)] animate-fade-in">

      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-orangeLuxe/20">
        <h2 id="qvTitle" class="text-2xl sm:text-3xl font-extrabold text-orangeLuxe-light">Report Preview</h2>
        <button data-close aria-label="Close modal" class="text-2xl text-orange-300 hover:text-orangeLuxe transition">
          ‚úñ
        </button>
      </div>

      <!-- Modal Body -->
      <div id="qvBody" class="px-6 py-5 space-y-5 text-sm leading-relaxed font-mono text-orange-100"></div>

      <!-- Modal Footer -->
      <div class="flex flex-wrap items-center justify-between gap-4 px-6 py-4 border-t border-orangeLuxe/20">
        <a id="qvFullLink" href="#" class="btn btn--outline text-sm">View Full Report ‚Üí</a>
        <div class="flex gap-3">
          <button id="qvPrev" class="navBtn hidden" aria-label="Previous report">‚Üê Prev</button>
          <button id="qvNext" class="navBtn hidden" aria-label="Next report">Next ‚Üí</button>
        </div>
      </div>

    </div>
  </div>
</template>

<style>
/* QuickView Modular Enhancements */
.navBtn {
  @apply rounded-md border border-orangeLuxe/60 px-3 py-1.5 text-sm text-orangeLuxe-light hover:bg-orangeLuxe/10 transition;
}

/* Fade Entrance */
@keyframes fade-in {
  0% { opacity: 0; transform: scale(0.95); }
  100% { opacity: 1; transform: scale(1); }
}
.animate-fade-in {
  animation: fade-in 0.5s ease-out;
}
</style>

<script>
/* üöÄ QuickView Modal System */
(() => {
  const tpl = document.getElementById("quickViewTpl");
  let current = null;

  function fill(report, opts = {}) {
    document.getElementById("qvTitle").textContent = report.title || "Report Preview";
    document.getElementById("qvBody").innerHTML = `
      <p>${report.description || "‚ö†Ô∏è No description available."}</p>
      <div class="grid sm:grid-cols-2 gap-4 mt-4" data-aos="fade-up"">
        ${report.date ? `<div><b>üìÖ Date:</b> ${new Date(report.date).toLocaleDateString()}</div>` : ""}
        ${report.severity ? `<div><b>üß™ Severity:</b> ${report.severity}</div>` : ""}
        <div><b>üìà CVSS:</b> ${typeof report.cvss === "number" ? report.cvss.toFixed(1) : "N/A"}</div>
        ${report.tags?.length ? `<div class="col-span-2 flex flex-wrap gap-2"><b class="mr-2">üè∑Ô∏è Tags:</b> ${report.tags.map(t => 
          `<span class="px-2 py-0.5 bg-orangeLuxe/10 rounded text-xs">${t}</span>`
        ).join("")}</div>` : ""}
      </div>
    `;
    document.getElementById("qvFullLink").href = `/reports/${report.slug || ""}`;

    ["Prev", "Next"].forEach(dir => {
      const btn = document.getElementById("qv" + dir);
      const fn = opts[dir.toLowerCase()];
      btn.classList.toggle("hidden", !fn);
      btn.onclick = fn;
    });
  }

  function open(report, opts = {}) {
    if (current) close();
    current = tpl.content.firstElementChild.cloneNode(true);
    document.body.appendChild(current);
    fill(report, opts);

    current.querySelector("[data-close]").addEventListener("click", close);
    current.addEventListener("keydown", (e) => {
      if (e.key === "Escape") close();
      if (e.key === "ArrowRight") opts.next?.();
      if (e.key === "ArrowLeft") opts.prev?.();
    });
    current.focus();
  }

  function close() {
    current?.remove();
    current = null;
  }

  window.QuickView = { open, close };
})();
</script>

