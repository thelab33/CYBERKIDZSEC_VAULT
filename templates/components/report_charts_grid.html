{# templates/components/report_charts_grid.html #}
<section
  class="grid md:grid-cols-2 gap-10 max-w-6xl mx-auto mt-24 px-6"
  data-aos="fade-up"
  data-aos-delay="200"
  aria-labelledby="charts-heading"
>
  <h2 id="charts-heading" class="sr-only">Vault Charts & Graphs</h2>

  <!-- ðŸ“Š CVSS Bar Chart -->
  <article class="chart-card border-orangeLuxe rounded-2xl p-6 backdrop-blur-md bg-zinc-900/60 shadow-xl"
           data-aos="fade-right"
           data-aos-delay="300"
           role="region"
           aria-labelledby="barTitle">
    <header class="chart-header flex justify-between items-center mb-4">
      <h3 id="barTitle" class="text-sm font-bold text-orange-300 font-mono uppercase tracking-widest">
        CVSS Avg per Year
      </h3>
      <select id="barView"
              class="bg-cyberNightGlow border border-orangeLuxe text-xs text-orangeLuxe rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-orangeLuxe"
              aria-label="Change CVSS view">
        <option value="yearly">Yearly</option>
        <option value="monthly">Monthly</option>
      </select>
    </header>
    <canvas id="barCanvas" height="320" role="img" aria-label="CVSS Bar Chart"></canvas>
  </article>

  <!-- ðŸ“ˆ Radar Chart -->
  <article class="chart-card border-pink-500 rounded-2xl p-6 backdrop-blur-md bg-zinc-900/60 shadow-xl"
           data-aos="fade-left"
           data-aos-delay="400"
           role="region"
           aria-labelledby="radarTitle">
    <header class="chart-header text-center mb-4">
      <h3 id="radarTitle" class="text-sm font-bold text-pink-400 font-mono uppercase tracking-widest">
        Severity Distribution
      </h3>
    </header>
    <canvas id="radarCanvas" height="320" role="img" aria-label="Severity Radar Chart"></canvas>
  </article>
</section>

<script type="module">
import { Chart } from "https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js";

function getCvssByYear() {
  return [{ year: 2022, cvss: 7.4 }, { year: 2023, cvss: 8.1 }, { year: 2024, cvss: 7.9 }];
}
function getMonthlyReportTrends() {
  return [
    { month: "Jan", count: 4 }, { month: "Feb", count: 8 },
    { month: "Mar", count: 5 }, { month: "Apr", count: 7 },
    { month: "May", count: 6 }, { month: "Jun", count: 3 }
  ];
}
function getSeverityRadarData() {
  return [
    { severity: "Critical", count: 6 },
    { severity: "High", count: 12 },
    { severity: "Medium", count: 15 },
    { severity: "Low", count: 9 }
  ];
}

const ctxBar = document.getElementById("barCanvas");
const ctxRadar = document.getElementById("radarCanvas");
const sel = document.getElementById("barView");
const barTitle = document.getElementById("barTitle");

let barChart, radarChart;
buildBar("yearly");
buildRadar();

sel.onchange = () => buildBar(sel.value);

function buildBar(view) {
  const data = view === "yearly" ? getCvssByYear() : getMonthlyReportTrends();
  const labels = data.map(d => view === "yearly" ? d.year : d.month);
  const key = view === "yearly" ? "cvss" : "count";
  const label = view === "yearly" ? "CVSS Avg" : "Reports";

  barTitle.textContent = view === "yearly" ? "CVSS Avg per Year" : "Reports per Month";
  barChart?.destroy();
  barChart = new Chart(ctxBar, {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label,
        data: data.map(d => d[key]),
        backgroundColor: "#f97316",
        borderRadius: 6
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: "#f8fafc" } },
        y: { ticks: { color: "#f8fafc" } }
      }
    }
  });
}

function buildRadar() {
  const data = getSeverityRadarData();
  radarChart = new Chart(ctxRadar, {
    type: "radar",
    data: {
      labels: data.map(d => d.severity),
      datasets: [{
        label: "Vulns",
        data: data.map(d => d.count),
        backgroundColor: "rgba(236,72,153,0.4)",
        borderColor: "#ec4899"
      }]
    },
    options: {
      plugins: { legend: { labels: { color: "#f8fafc" } } },
      scales: {
        r: {
          angleLines: { color: "#555" },
          grid: { color: "#555" },
          pointLabels: { color: "#f8fafc" },
          ticks: { color: "#f8fafc" }
        }
      }
    }
  });
}
</script>

