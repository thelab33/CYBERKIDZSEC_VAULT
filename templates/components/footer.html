<footer id="footer"
        class="relative mt-32 border-t border-orangeLuxe/25 bg-gradient-to-b from-zinc-900 via-black to-black px-6 py-20 text-sm font-mono text-orange-200 overflow-hidden"
        data-vault-stability="{{ vault_xp_percentage }}">

  <!-- üåå Animated Aurora Ribbon -->
  <div aria-hidden class="pointer-events-none absolute -top-1 left-0 w-full h-1 bg-gradient-to-r from-transparent via-orangeLuxe to-transparent animate-[pulse-glow_4s_infinite]"></div>

  <!-- üå´Ô∏è Noise Overlay -->
  <div aria-hidden class="absolute inset-0 bg-[url('/static/img/noise.png')] opacity-5 mix-blend-overlay"></div>

  <!-- üìö Content Grid -->
  <div class="relative z-10 max-w-7xl mx-auto grid gap-10 sm:grid-cols-2 xl:grid-cols-4" data-aos="fade-up">

    <!-- üõ°Ô∏è Brand & Motto -->
    <div class="space-y-2">
      <p class="text-xs tracking-widest text-orange-400 font-bold select-none">CYBERKIDZSEC VAULT</p>
      <p class="text-sm text-orangeLuxe-light">¬© {{ current_year }} CyberKidzSec</p>
      <p class="mt-4 italic text-orangeLuxe-light/80 max-w-[16rem]">‚ÄúGhosted but not gone.‚Äù</p>
      <p class="terminal-footer-prompt">~$ system.exit(0) ‚Äî stay ghosted üß†</p>
    </div>

    <!-- üß≠ Quick Navigation -->
    <nav class="flex flex-col gap-2 text-orange-300">
      {% set nav = [("Home","/"),("About","/about"),("Reports","/reports"),("Playground","/playground"),("Analytics","/charts")] %}
      {% for label, href in nav %}
        <a href="{{ href }}" class="w-max hover:text-orangeLuxe hover:underline transition">{{ label }}</a>
      {% endfor %}
    </nav>

    <!-- üìà Vault Analytics -->
    <div class="space-y-3">
      <p class="text-xs tracking-wide text-orange-300/80">üõ∞Ô∏è Latest CVEs (24h)</p>
      <p id="cveCounter" class="text-4xl font-black text-orangeLuxe-light animate-pulse">--</p>
      <a href="/charts" class="btn-secondary w-max text-xs">View Analytics ‚Üí</a>
    </div>

    <!-- üì® Newsletter + Socials -->
    <div class="space-y-5">
      <form action="https://buttondown.email/api/emails/embed-subscribe/cyberkidzsec" method="post" target="popupwindow"
            class="flex gap-2" onsubmit="window.open('https://buttondown.email/cyberkidzsec','popupwindow')">
        <input required type="email" name="email" placeholder="your@domain.tld"
               class="flex-1 rounded-md bg-zinc-800 border border-orangeLuxe/40 px-3 py-2 text-xs placeholder-orangeLuxe-light focus:outline-none" />
        <button class="rounded-md bg-orangeLuxe px-4 py-2 text-xs font-bold text-black hover:bg-orange-500" aria-label="Subscribe">Join</button>
      </form>

      <div class="flex gap-4 text-xl text-orange-400">
        <a href="https://github.com/thelab33/cyberkidzsec-vault" target="_blank" rel="noopener" aria-label="GitHub" class="hover:text-orangeLuxe transition"><i class="fa-brands fa-github"></i></a>
        <a href="https://linkedin.com/in/cyberkidzsec" target="_blank" rel="noopener" aria-label="LinkedIn" class="hover:text-orangeLuxe transition"><i class="fa-brands fa-linkedin"></i></a>
        <a href="/submit" aria-label="Submit vulnerability" class="hover:text-orangeLuxe transition"><i class="fa-solid fa-bug"></i></a>
      </div>

      <button id="themeToggler" class="inline-flex items-center gap-2 text-xs btn-secondary mt-3">
        <i class="fa-solid fa-circle-half-stroke"></i> Toggle Theme
      </button>
    </div>
  </div>

  <!-- üö® Ghost Breach Alert -->
  <div id="ghostBreachWarning" class="ghost-breach-warning hidden animate-pulse mt-6 px-4 py-2 border border-red-400 text-red-400 rounded-lg text-center text-sm font-bold font-mono">
    ‚ö†Ô∏è VAULT BREACH DETECTED
  </div>

  <!-- üß† Vault Stability Bar -->
  <div class="relative mt-10 max-w-6xl mx-auto">
    <div class="w-full h-2 bg-zinc-800 rounded-full overflow-hidden">
      <div class="h-full transition-all duration-1000 ease-in-out" style="width: {{ vault_xp_percentage }}%; background: linear-gradient(to right, #f59e0b, #facc15, #34d399);"></div>
    </div>
    <p class="text-center text-xs text-orange-400 mt-2">Vault Stability: {{ vault_xp_percentage }}%</p>
  </div>
</footer>

<style>
.ghost-breach-warning {
  text-align: center;
  padding: 1rem;
  background-color: rgba(255, 71, 71, 0.08);
  color: #f87171;
  font-weight: bold;
  font-family: var(--font-mono, monospace);
  margin-top: 2rem;
  border: 1px solid #f87171;
  border-radius: 0.75rem;
  animation: pulse 2s infinite;
}
@keyframes toastFade {
  0% { opacity: 0; transform: translateY(10px); }
  20% { opacity: 1; transform: translateY(0); }
  80% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-10px); }
}
.toast {
  position: fixed;
  bottom: 80px;
  right: 20px;
  background: #10b981;
  color: white;
  font-family: monospace;
  padding: 0.75rem 1.25rem;
  border-radius: 0.5rem;
  box-shadow: 0 0 20px rgba(16,185,129,0.5);
  animation: toastFade 4s ease-in-out forwards;
  z-index: 9999;
}
</style>

<script type="module">
import confetti from 'https://cdn.skypack.dev/canvas-confetti';

(() => {
  const vaultXP = parseInt("{{ vault_xp_percentage }}") || 0;

  // Animate Vault XP bar
  const bar = document.querySelector('#footer .h-full[style*="width"]');
  if (bar) {
    bar.style.width = "0%";
    setTimeout(() => {
      bar.style.transition = "width 2.2s ease-in-out";
      bar.style.width = vaultXP + "%";
    }, 200);
  }

  // CVE shimmer while fetching
  const cveCounter = document.getElementById("cveCounter");
  if (cveCounter) {
    cveCounter.textContent = "‚Ä¶";
    fetch("https://cve.circl.lu/api/last")
      .then(res => res.json())
      .then(data => {
        if (Array.isArray(data)) {
          cveCounter.textContent = data.length.toLocaleString();
          cveCounter.title = `${data.length} CVEs in last 24h`;
        }
      })
      .catch(() => {
        cveCounter.textContent = "‚ö†Ô∏è";
        cveCounter.title = "CVE feed unavailable";
      });
  }

  // Ghost Breach Detection (persistent session-based)
  const breachFlag = sessionStorage.getItem("vault_breach");
  const ghostWarning = document.getElementById("ghostBreachWarning");
  if (window.location.search.includes("breach=true")) {
    sessionStorage.setItem("vault_breach", "1");
  }
  if (breachFlag === "1" && ghostWarning) {
    ghostWarning.style.display = "block";
    ghostWarning.classList.add("animate-pulse");
    ghostWarning.setAttribute("role", "alert");
    ghostWarning.setAttribute("aria-live", "assertive");
  }

  // Autosave email for newsletter
  const emailInput = document.querySelector('input[name="email"]');
  if (emailInput) {
    const savedEmail = localStorage.getItem("vault_newsletter_email");
    if (savedEmail) emailInput.value = savedEmail;
    emailInput.addEventListener("input", e => {
      localStorage.setItem("vault_newsletter_email", e.target.value.trim());
    });
  }

  // Confetti + toast on subscribe
  const form = document.querySelector('form[action*="buttondown.email"]');
  if (form) {
    form.addEventListener("submit", () => {
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.textContent = "üì¨ Subscribed! GhostMail en route.";
      document.body.appendChild(toast);
      confetti({
        particleCount: 70,
        spread: 90,
        origin: { y: 0.6 },
      });
    });
  }

  // Persistent Theme Toggler + URL override
  const themeBtn = document.getElementById("themeToggler");
  const html = document.documentElement;
  const setTheme = (theme) => {
    html.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
  };
  const urlTheme = new URLSearchParams(window.location.search).get("theme");
  if (urlTheme && (urlTheme === "light" || urlTheme === "dark")) {
    setTheme(urlTheme);
  } else {
    const current = localStorage.getItem("theme") || html.getAttribute("data-theme") || "dark";
    setTheme(current);
  }
  themeBtn?.addEventListener("click", () => {
    const next = html.getAttribute("data-theme") === "dark" ? "light" : "dark";
    setTheme(next);
  });

  // Optional: Scroll to newsletter form if ?subscribe=true
  if (window.location.search.includes("subscribe=true")) {
    setTimeout(() => {
      form?.scrollIntoView({ behavior: "smooth", block: "center" });
      emailInput?.focus();
    }, 600);
  }
})();
</script>


