<!-- templates/components/skip_nav.html -->
<div id="skipBar"
     role="navigation"
     aria-label="Skip Navigation Bar"
     class="fixed top-0 left-0 right-0 z-[9998] flex items-center justify-between
            bg-gradient-to-r from-green-400 via-cyan-400 to-green-400
            p-3 text-black font-mono text-sm uppercase tracking-wider shadow-xl
            transform -translate-y-40 transition-transform duration-500 ease-out pointer-events-none">

  <!-- üöÄ WARP MODE Text -->
  <div id="warpText"
       class="absolute top-0 inset-x-0 text-center text-green-400 font-black tracking-widest
              text-lg mix-blend-difference opacity-0 scale-90 -translate-y-1/2
              transition-all duration-500 ease-in-out glitch-flicker shake-on-show">
    WARP MODE ENGAGED
  </div>

  <!-- üåê Accessible Skip Links -->
  <div class="flex gap-6">
    <a href="#main"
       class="hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-black rounded px-2 py-1">
      Skip to Main
    </a>
    <a href="#footer"
       class="hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-black rounded px-2 py-1">
      Skip to Footer
    </a>
  </div>

  <!-- ‚ùå Close Button -->
  <button id="skipBarClose"
          aria-label="Close Skip Navigation"
          class="rounded-full bg-black text-green-400 hover:bg-green-400 hover:text-black transition p-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-black">
    ‚úñÔ∏è
  </button>

  <!-- üéâ Confetti Canvas -->
  <canvas id="confettiCanvas" class="absolute inset-0 pointer-events-none z-[9997]"></canvas>
</div>

<style>
  @keyframes cyberpunkFlicker {
    0% { opacity: 1; text-shadow: 0 0 2px lime, 0 0 10px cyan; }
    100% { opacity: 0.9; text-shadow: 0 0 1px lime, 0 0 6px cyan; }
  }
  .glitch-flicker {
    animation: cyberpunkFlicker 2.5s infinite alternate;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-4px); }
    40%, 80% { transform: translateX(4px); }
  }
  .shake-on-show {
    animation: shake 0.6s ease-in-out;
  }
</style>

<script>
(() => {
  const skipBar = document.getElementById("skipBar");
  const warpText = document.getElementById("warpText");
  const closeBtn = document.getElementById("skipBarClose");
  const confettiCanvas = document.getElementById("confettiCanvas");
  let confetti;

  function showSkipBar() {
    skipBar.classList.remove("-translate-y-40", "pointer-events-none");
    skipBar.classList.add("translate-y-0");
    warpText.classList.remove("opacity-0", "scale-90", "-translate-y-1/2");
    warpText.classList.add("opacity-100", "scale-100", "translate-y-0");

    try {
      new Audio("/static/audio/warp-sound.mp3").play();
    } catch (_) {}

    confetti = ConfettiGenerator({ target: confettiCanvas, max: 80 });
    confetti.render();

    setTimeout(() => {
      warpText.classList.add("opacity-0", "scale-90", "-translate-y-1/2");
      warpText.classList.remove("opacity-100", "scale-100", "translate-y-0");
    }, 1500);

    setTimeout(() => document.querySelector("#skipBar a")?.focus(), 400);
  }

  function hideSkipBar() {
    skipBar.classList.add("-translate-y-40", "pointer-events-none");
    skipBar.classList.remove("translate-y-0");
    if (confetti) confetti.clear();
  }

  window.addEventListener("keydown", (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === "ArrowUp") {
      e.preventDefault();
      showSkipBar();
    }
    if (e.key === "Escape") {
      hideSkipBar();
    }
  });

  closeBtn.addEventListener("click", hideSkipBar);
})();
</script>

