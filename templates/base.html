<!DOCTYPE html>
<html lang="en"
      class="scroll-smooth motion-safe:scroll-auto bg-cyberNight text-zinc-100 antialiased flex flex-col min-h-screen"
      data-theme="dark">
<head>
  <!-- 🌐 Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="description" content="{% block meta_desc %}CYBERKIDZSEC — Zero-Day Vault.{% endblock %}" />
  <title>{% block title %}CYBERKIDZSEC Vault{% endblock %}</title>

  <!-- 📲 Icons & PWA -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <link rel="icon" href="{{ url_for('static', filename='favicon-32.png') }}" sizes="32x32" />
  <link rel="icon" href="{{ url_for('static', filename='favicon-16.png') }}" sizes="16x16" />
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}" />

  <!-- 🌐 Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" as="style" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />

  <!-- 🎨 Core Styles -->
  {% set styles = [
    'css/app.min.css',
    'css/ghost-mode.css',
    'css/ghost-boot.css',
    'css/bug_tales.css',
    'css/back_to_top.css',
    'css/cyber-enhancements.css'
  ] %}
  {% for sheet in styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename=sheet) }}" />
  {% endfor %}

  <!-- 📦 External Libs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />

  {% block head_extra %}{% endblock %}

  <!-- 🦾 AOS No-JS Fallback -->
  <noscript>
    <style>.aos-init[data-aos] { opacity: 1 !important; transform: none !important; }</style>
  </noscript>
</head>

<body class="relative selection:bg-orangeLuxe/20 selection:text-orangeLuxe" data-page="vault">
  <!-- ⌨️ Skip Links -->
  {% include "components/skip_nav.html" %}

  <!-- 🛰️ Top Section -->
  <header role="banner" class="z-50">
    {% if operative_title %}
      <p class="text-orange-400 text-sm text-center font-bold uppercase mb-2 tracking-wider sr-only" aria-live="polite">
        {{ operative_title }}
      </p>
    {% endif %}
    {% include "components/header.html" %}
    <div id="scrollProgress" class="scroll-progress fixed top-0 left-0 h-1 bg-orangeLuxe transition-all duration-300 ease-out z-40"></div>
  </header>

  <!-- 🚀 Main Page Content -->
  <main id="main" class="flex-1" role="main" tabindex="-1">
    {% block content %}{% endblock %}
  </main>

  <!-- 🎛️ HUD Components -->
  {% include "components/vault_popup.html" %}
  {% include "components/vault_copilot.html" %}
  {% include "components/section_skeleton.html" %}
  {% include "components/quick_view_modal.html" %}
  {% include "components/hud_toolbar.html" %}
  {% include "components/command_palette.html" %}

  <!-- 🧭 Footer -->
  {% include "components/footer.html" %}
  {% include "components/back_to_top.html" %}
  {% block breadcrumbs %}{% endblock %}

  <!-- ⚙️ Scripts -->
  {% set scripts = [
    'js/app.min.js',
    'js/ghost-mode.js',
    'js/cyber-enhancements.js',
    'js/init.js'
  ] %}
  {% for script in scripts %}
    <script src="{{ url_for('static', filename=script) }}" defer></script>
  {% endfor %}
  <script type="module" src="{{ url_for('static', filename='js/main.js') }}" defer></script>
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js" defer></script>

  <!-- 🧠 Local Enhancements -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      AOS.init({ duration: 800, easing: 'ease-in-out', once: true, offset: 120 });

      // 🌗 Restore Theme
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) document.documentElement.setAttribute("data-theme", savedTheme);

      // 🧠 Scroll Restore
      if ("scrollRestoration" in history) history.scrollRestoration = "manual";

      // ⌨️ Shortcut prompt
      if (window.matchMedia('(hover: hover)').matches) {
        const hint = document.createElement("div");
        hint.textContent = "⌘ Cmd + K — Search";
        hint.className = "fixed bottom-2 right-4 z-[999] text-xs text-orange-400 font-mono animate-pulse";
        document.body.appendChild(hint);
        setTimeout(() => hint.remove(), 4000);
      }
    });
  </script>

  <!-- 🔐 PWA Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .catch(e => console.warn('🔒 Service Worker registration failed:', e));
      });
    }
  </script>

  {% block scripts_extra %}{% endblock %}

  {% if config['ENV'] == 'production' %}
    <script defer data-domain="cyberkidzsec.com" src="https://plausible.io/js/script.js"></script>
  {% endif %}
</body>
</html>

