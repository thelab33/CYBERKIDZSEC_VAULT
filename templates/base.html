<!doctype html>
<html lang="en" class="scroll-smooth" data-theme="{{ theme or 'dark' }}" data-ghostmode="{{ ghost or false }}">
<head>
  <!-- ðŸŒ Core Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="robots" content="index, follow" />
  <meta name="description" content="{% block meta_desc %}CYBERKIDZSEC â€” Zero-Day Vault.{% endblock %}" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta name="color-scheme" content="dark light" />

  <title>{% block title %}CYBERKIDZSEC Vault{% endblock %}</title>

  <!-- ðŸ”Œ PWA Support -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}" />
  <meta name="apple-mobile-web-app-capable" content="yes" />

  <!-- ðŸ–¼ Favicons -->
  <link rel="icon" href="{{ url_for('static', filename='favicon-32.png') }}" sizes="32x32" />
  <link rel="icon" href="{{ url_for('static', filename='favicon-16.png') }}" sizes="16x16" />
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}" />

  <!-- ðŸŒ Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />

  <!-- ðŸŽ¨ Tailwind + Site Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.min.css') }}" />

  <!-- âš™ï¸ Always-on Enhancements -->
  {% for css_file in [
    'css/ghost-mode.css',
    'css/ghost-boot.css',
    'css/bug_tales.css',
    'css/back_to_top.css',
    'css/cyberpunk.css'
  ] %}
    <link rel="stylesheet" href="{{ url_for('static', filename=css_file) }}" />
  {% endfor %}

  <!-- ðŸ“¦ Vendor Styles -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-KKyjR..." crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />

  {% block head_extra %}{% endblock %}

  <!-- ðŸš« Fallback for AOS if JS is disabled -->
  <noscript>
    <style>
      .aos-init[data-aos] { opacity: 1 !important; transform: none !important; }
    </style>
  </noscript>
</head>

<body class="bg-cyberNight text-zinc-100 antialiased flex flex-col min-h-screen">

  <!-- âŒ¨ï¸ Accessibility: Skip Link -->
  {% include "components/skip_nav.html" ignore missing %}

  <!-- ðŸ›°ï¸ Operative Title Banner -->
  {% if operative_title %}
    <p class="text-orange-400 text-sm text-center font-bold uppercase mb-4 tracking-widest">
      {{ operative_title }}
    </p>
  {% endif %}

  <!-- ðŸ” Header + Scroll Progress + Theme Toggles -->
  {% include "components/header.html" ignore missing %}
  <div id="scrollProgress" class="scroll-progress"></div>
  <div class="fixed top-4 right-4 z-50 flex gap-2">
    <button onclick="toggleTheme()" class="bg-zinc-800 px-2 py-1 rounded text-white text-xs">ðŸŒ— Theme</button>
    <button onclick="toggleGhost()" class="bg-zinc-800 px-2 py-1 rounded text-white text-xs">ðŸ‘» Ghost</button>
  </div>

  <!-- ðŸš€ Main Vault Content -->
  <main id="main" role="main" class="flex-1">
    {% block content %}{% endblock %}
  </main>

  <!-- ðŸŽ› Modals & Toolbars -->
  {% include "components/vault_popup.html" ignore missing %}
  {% include "components/quick_view_modal.html" ignore missing %}
  {% include "components/hud_toolbar.html" ignore missing %}
  {% include "components/command_palette.html" ignore missing %}

  <!-- ðŸ§­ Footer -->
  {% include "components/footer.html" ignore missing %}
  {% include "components/back_to_top.html" ignore missing %}

  <!-- âš™ï¸ Scripts -->
  <script src="{{ url_for('static', filename='js/app.min.js') }}" defer></script>
  <script type="module" src="{{ url_for('static', filename='js/main.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/ghost-mode.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/cyber-enhancements.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/init.js') }}" defer></script>

  <!-- ðŸŽ¨ AOS Animations -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      AOS.init({ duration: 800, easing: 'ease-in-out', once: true, mirror: false, offset: 120 });
    });
  </script>

  <!-- ðŸ” Auto-scroll to top on page refresh -->
  <script>
    window.addEventListener('beforeunload', () => {
      window.scrollTo({ top: 0, behavior: 'auto' });
    });
  </script>

  <!-- ðŸŽ® Konami Code Vault Unlock -->
  <script>
    const kCode = [38,38,40,40,37,39,37,39,66,65], buffer = [];
    window.addEventListener("keydown", e => {
      buffer.push(e.keyCode); buffer.splice(-kCode.length - 1, buffer.length - kCode.length);
      if (kCode.every((v,i) => v === buffer[i])) {
        document.body.classList.add("vault-unlocked");
        alert("ðŸš¨ VAULT OVERRIDE: Welcome, Operative.");
      }
    });
  </script>

  <!-- ðŸŒ— Theme + Ghost Mode Sync -->
  <script>
    function toggleTheme() {
      const root = document.documentElement;
      const current = root.dataset.theme || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    }

    function toggleGhost() {
      const root = document.documentElement;
      const ghost = root.dataset.ghostmode === 'true';
      const newVal = !ghost;
      root.setAttribute('data-ghostmode', newVal);
      localStorage.setItem('ghostmode', newVal);
    }

    document.addEventListener("DOMContentLoaded", () => {
      const savedTheme = localStorage.getItem('theme');
      const ghost = localStorage.getItem('ghostmode') === 'true';
      if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
      document.documentElement.setAttribute('data-ghostmode', ghost);
    });
  </script>

  <!-- ðŸ›°ï¸ Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () =>
        navigator.serviceWorker.register('/sw.js').catch(e =>
          console.warn('Service Worker registration failed:', e)
        )
      );
    }
  </script>

  {% block scripts_extra %}{% endblock %}

  {% if config['ENV'] == 'production' %}
    <!-- ðŸ“ˆ Analytics (Plausible) -->
    <script defer data-domain="cyberkidzsec.com" src="https://plausible.io/js/script.js"></script>
  {% endif %}

</body>
</html>

